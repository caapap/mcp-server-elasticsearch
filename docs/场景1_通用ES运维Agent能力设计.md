# åœºæ™¯ 1: é€šç”¨ ES æ•…éšœæ’æŸ¥ä¸æ•°æ®æŸ¥è¯¢ - é«˜çº§ Agent èƒ½åŠ›è®¾è®¡

## ä¸€ã€åŸºç¡€èƒ½åŠ›çŸ©é˜µ

åŸºäºç°æœ‰çš„ 8 ä¸ª MCP å·¥å…·ï¼ŒAgent å…·å¤‡ä»¥ä¸‹èƒ½åŠ›ç»´åº¦ï¼š

| èƒ½åŠ›ç»´åº¦ | æ¶‰åŠå·¥å…· | èƒ½åŠ›çº§åˆ« |
|---------|---------|---------|
| **é›†ç¾¤å¥åº·è¯Šæ–­** | `get_cluster_health`, `get_nodes_info`, `get_shards` | â­â­â­â­â­ |
| **ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†** | `list_indices`, `list_indices_detailed`, `get_mappings` | â­â­â­â­ |
| **æ•°æ®æ£€ç´¢ä¸åˆ†æ** | `esql`, `search` | â­â­â­â­â­ |
| **æ ¹å› åˆ†æ** | å¤šå·¥å…·ç»„åˆæ¨ç† | â­â­â­â­ |
| **é¢„æµ‹æ€§ç»´æŠ¤** | è¶‹åŠ¿åˆ†æ + çŸ¥è¯†å›¾è°± | â­â­â­ |

---

## äºŒã€é«˜çº§ Agent èƒ½åŠ›è®¾è®¡

### ğŸ” èƒ½åŠ› 1: è‡ªåŠ¨åŒ–æ•…éšœè¯Šæ–­ä¸æ ¹å› å®šä½

#### å…¸å‹åœºæ™¯
**ç”¨æˆ·è¾“å…¥**: "é›†ç¾¤å˜æ…¢äº†ï¼Œå¸®æˆ‘æŸ¥ä¸€ä¸‹æ˜¯ä»€ä¹ˆé—®é¢˜"

#### Agent æ¨ç†é“¾ (Multi-Tool Orchestration)

```
ç¬¬ 1 æ­¥: å…¨å±€å¥åº·æ£€æŸ¥
  â””â”€ è°ƒç”¨ get_cluster_health
      â”œâ”€ å¦‚æœ status = "red" â†’ è¿›å…¥ã€åˆ†ç‰‡ä¸¢å¤±åˆ†æ”¯ã€‘
      â”œâ”€ å¦‚æœ status = "yellow" â†’ è¿›å…¥ã€å‰¯æœ¬æœªåˆ†é…åˆ†æ”¯ã€‘
      â””â”€ å¦‚æœ status = "green" â†’ è¿›å…¥ã€æ€§èƒ½é—®é¢˜åˆ†æ”¯ã€‘

ç¬¬ 2 æ­¥: å®šä½é—®é¢˜ç´¢å¼• (é’ˆå¯¹ Red/Yellow)
  â””â”€ è°ƒç”¨ list_indices_detailed(health="red" æˆ– "yellow", sort_by="docs.count")
      â””â”€ è¾“å‡º: æ‰¾åˆ° 3 ä¸ªå¼‚å¸¸ç´¢å¼•ï¼Œå…¶ä¸­ "logs-2025.01" æœ€å¤§ (500GB)

ç¬¬ 3 æ­¥: åˆ†ç‰‡çº§è¯Šæ–­
  â””â”€ è°ƒç”¨ get_shards(index="logs-2025.01")
      â””â”€ åˆ†æç»“æœ:
          â”œâ”€ ä¸»åˆ†ç‰‡ 2 å¤„äº UNASSIGNED çŠ¶æ€
          â”œâ”€ åŸåˆ†é…èŠ‚ç‚¹: node-3
          â””â”€ æ¨æµ‹: node-3 å¯èƒ½ç¦»çº¿æˆ–ç£ç›˜æ»¡

ç¬¬ 4 æ­¥: èŠ‚ç‚¹å¥åº·ç¡®è®¤
  â””â”€ è°ƒç”¨ get_nodes_info()
      â””â”€ å‘ç°:
          â”œâ”€ node-1: heap 75%, disk 60%, load 2.3
          â”œâ”€ node-2: heap 80%, disk 85%, load 3.1
          â””â”€ node-3: ä¸åœ¨åˆ—è¡¨ä¸­ â†’ ç¡®è®¤ç¦»çº¿

ç¬¬ 5 æ­¥: æ ¹å› æŠ¥å‘Š
  â””â”€ ç»¼åˆæ¨ç†è¾“å‡º:
      """
      ğŸ”´ æ ¹å› å®šä½ï¼šNode-3 èŠ‚ç‚¹ç¦»çº¿
      
      **å½±å“èŒƒå›´**:
      - ç´¢å¼• logs-2025.01 çš„ä¸»åˆ†ç‰‡ 2 ä¸¢å¤±
      - å¯èƒ½å¯¼è‡´è¯¥ç´¢å¼•éƒ¨åˆ†æ•°æ®ä¸å¯æŸ¥è¯¢
      
      **ç´§æ€¥æªæ–½**:
      1. æ£€æŸ¥ node-3 æœåŠ¡å™¨çŠ¶æ€: ssh node-3 && systemctl status elasticsearch
      2. å¦‚æœæ— æ³•æ¢å¤ï¼Œè€ƒè™‘æ‰‹åŠ¨é‡æ–°åˆ†é…åˆ†ç‰‡:
         POST /_cluster/reroute
         {
           "commands": [
             {"allocate_replica": {"index": "logs-2025.01", "shard": 2, "node": "node-1"}}
           ]
         }
      
      **é¢„é˜²æªæ–½**:
      - node-2 ç£ç›˜ä½¿ç”¨ç‡å·²è¾¾ 85%ï¼Œå»ºè®®æ¸…ç†æ—§ç´¢å¼•æˆ–æ‰©å®¹
      """
```

#### å…³é”®èƒ½åŠ›
*   **å¤šå·¥å…·ååŒ**: 4 ä¸ªå·¥å…·ä¸²è”è°ƒç”¨ï¼Œé€å±‚æ·±å…¥ã€‚
*   **æ¡ä»¶åˆ†æ”¯**: æ ¹æ®ä¸­é—´ç»“æœåŠ¨æ€å†³å®šä¸‹ä¸€æ­¥ã€‚
*   **æ¨ç†èƒ½åŠ›**: ä»"åˆ†ç‰‡æœªåˆ†é… + èŠ‚ç‚¹åˆ—è¡¨ç¼ºå¤±"æ¨å¯¼å‡º"èŠ‚ç‚¹ç¦»çº¿"ã€‚

---

### ğŸ“Š èƒ½åŠ› 2: æ™ºèƒ½æ•°æ®æ¢ç´¢ä¸æ´å¯Ÿæå–

#### å…¸å‹åœºæ™¯
**ç”¨æˆ·è¾“å…¥**: "å¸®æˆ‘åˆ†æä¸€ä¸‹æœ€è¿‘ä¸€å‘¨çš„é”™è¯¯æ—¥å¿—è¶‹åŠ¿"

#### Agent æ¨ç†é“¾

```
ç¬¬ 1 æ­¥: ç´¢å¼•è¯†åˆ« (å…³é”®è¯åŒ¹é… + æ¨¡å¼æ¨æ–­)
  â””â”€ è°ƒç”¨ list_indices(index_pattern="*log*")
      â””â”€ å€™é€‰: logs-2025.01, app-logs-2025.01, system-logs-*

ç¬¬ 2 æ­¥: å­—æ®µæ¢æŸ¥
  â””â”€ è°ƒç”¨ get_mappings(index="logs-2025.01")
      â””â”€ å‘ç°å…³é”®å­—æ®µ:
          â”œâ”€ @timestamp: date
          â”œâ”€ log.level: keyword (å¯èƒ½çš„å€¼: INFO, WARN, ERROR)
          â””â”€ message: text

ç¬¬ 3 æ­¥: æ„é€ æ—¶åºèšåˆæŸ¥è¯¢ (ES|QL ä¼˜å…ˆ)
  â””â”€ è°ƒç”¨ esql({
      query: `
        FROM logs-2025.* 
        | WHERE @timestamp >= NOW() - 7 DAYS 
          AND log.level == "ERROR"
        | STATS error_count = COUNT(*) BY DATE_TRUNC(@timestamp, 1 DAY) AS day
        | SORT day ASC
      `
    })
    â””â”€ ç»“æœ:
        2025-01-15: 120 errors
        2025-01-16: 95 errors
        2025-01-17: 310 errors â† å¼‚å¸¸å³°å€¼
        2025-01-18: 105 errors
        ...

ç¬¬ 4 æ­¥: å¼‚å¸¸ç‚¹æ·±æŒ–
  â””â”€ æ£€æµ‹åˆ° 01-17 é”™è¯¯é‡æ¿€å¢ â†’ è‡ªåŠ¨è¿½æŸ¥
  â””â”€ è°ƒç”¨ esql({
      query: `
        FROM logs-2025.01
        | WHERE @timestamp >= "2025-01-17T00:00:00"
          AND @timestamp < "2025-01-18T00:00:00"
          AND log.level == "ERROR"
        | STATS count = COUNT(*) BY error_message
        | SORT count DESC
        | LIMIT 5
      `
    })
    â””â”€ å‘ç°: "Database connection timeout" å  85%

ç¬¬ 5 æ­¥: æ´å¯ŸæŠ¥å‘Š
  â””â”€ è¾“å‡º:
      """
      ğŸ“ˆ é”™è¯¯æ—¥å¿—è¶‹åŠ¿åˆ†æ (æœ€è¿‘ 7 å¤©)

      **æ€»ä½“è¶‹åŠ¿**: ç¨³å®šï¼ˆæ—¥å‡ ~110 æ¡ï¼‰ï¼Œä½† 1 æœˆ 17 æ—¥å‡ºç°å¼‚å¸¸å³°å€¼ (310 æ¡)

      **å¼‚å¸¸æ ¹å› **:
      - 85% çš„é”™è¯¯æ¥è‡ª "Database connection timeout"
      - å¯èƒ½åŸå› : æ•°æ®åº“æœåŠ¡ä¸­æ–­æˆ–ç½‘ç»œæŠ–åŠ¨

      **å»ºè®®**:
      - æ£€æŸ¥ 1 æœˆ 17 æ—¥çš„æ•°æ®åº“ç›‘æ§æ—¥å¿—
      - è¯„ä¼°æ•°æ®åº“è¿æ¥æ± é…ç½®æ˜¯å¦åˆç†
      """
```

#### å…³é”®èƒ½åŠ›
*   **è‡ªé€‚åº”æŸ¥è¯¢æ„é€ **: æ ¹æ® Mapping è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„å­—æ®µåå’Œç±»å‹ã€‚
*   **å¤šé˜¶æ®µåˆ†æ**: å…ˆå®è§‚è¶‹åŠ¿ â†’ å†å¼‚å¸¸æ£€æµ‹ â†’ æœ€åç»†èŠ‚è¿½è¸ªã€‚
*   **ES|QL æµç•…æ€§**: ä½¿ç”¨ç®¡é“ç¬¦ã€èšåˆå‡½æ•°ã€æ—¶é—´å¤„ç†ç­‰é«˜çº§ç‰¹æ€§ã€‚

---

### ğŸ§  èƒ½åŠ› 3: ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å¯¹è¯å¼æŸ¥è¯¢

#### å…¸å‹åœºæ™¯
**å¤šè½®å¯¹è¯ç¤ºä¾‹**:

```
User: "å¸®æˆ‘çœ‹ä¸‹ç”¨æˆ·ç™»å½•å¤±è´¥çš„æƒ…å†µ"

Agent (ç¬¬ 1 è½®):
  â””â”€ æ¨æ–­å…³é”®è¯: "ç™»å½•" + "å¤±è´¥" â†’ å¯èƒ½çš„ç´¢å¼•: *login*, *audit*, *access*
  â””â”€ è°ƒç”¨ list_indices(index_pattern="*login*")
      â””â”€ æ‰¾åˆ°: user-login-2025.01
  â””â”€ è°ƒç”¨ esql({
      query: `FROM user-login-2025.01 | WHERE status == "failed" | LIMIT 5`
    })
  â””â”€ è¾“å‡ºæ ·æœ¬æ•°æ® + è¯¢é—®:
      "æ‰¾åˆ° 123 æ¡å¤±è´¥è®°å½•ï¼Œæ˜¯å¦éœ€è¦æŒ‰å¤±è´¥åŸå› åˆ†ç»„ç»Ÿè®¡ï¼Ÿ"

User: "æŒ‰å¤±è´¥åŸå› åˆ†ç»„ï¼Œå¹¶æ˜¾ç¤º TOP 3"

Agent (ç¬¬ 2 è½®):
  â””â”€ è®°å¿†ä¸Šä¸‹æ–‡: index=user-login-2025.01, condition=status=="failed"
  â””â”€ è°ƒç”¨ esql({
      query: `
        FROM user-login-2025.01
        | WHERE status == "failed"
        | STATS count = COUNT(*) BY failure_reason
        | SORT count DESC
        | LIMIT 3
      `
    })
  â””â”€ è¾“å‡º:
      1. Invalid password: 85 æ¬¡
      2. Account locked: 23 æ¬¡
      3. Token expired: 15 æ¬¡

User: "æŠŠ Invalid password çš„ç”¨æˆ·ååˆ—å‡ºæ¥"

Agent (ç¬¬ 3 è½®):
  â””â”€ ç»§æ‰¿å‰ä¸¤è½®ä¸Šä¸‹æ–‡ + æ–°æ¡ä»¶: failure_reason=="Invalid password"
  â””â”€ è°ƒç”¨ esql({
      query: `
        FROM user-login-2025.01
        | WHERE status == "failed" AND failure_reason == "Invalid password"
        | KEEP username, @timestamp
        | LIMIT 20
      `
    })
```

#### å…³é”®èƒ½åŠ›
*   **ä¼šè¯è®°å¿†**: è®°ä½ç´¢å¼•åã€è¿‡æ»¤æ¡ä»¶ã€ç”¨æˆ·æ„å›¾ã€‚
*   **æ¸è¿›å¼æé—®**: ä»æ¨¡ç³Šéœ€æ±‚ â†’ ç²¾ç¡®æŸ¥è¯¢çš„å¼•å¯¼å¼äº¤äº’ã€‚
*   **æŸ¥è¯¢å¤ç”¨**: åœ¨å‰ä¸€è½®çš„åŸºç¡€ä¸Šå¢é‡æ·»åŠ æ¡ä»¶ï¼Œè€Œä¸æ˜¯é‡æ–°å¼€å§‹ã€‚

---

### ğŸ”¬ èƒ½åŠ› 4: å¤æ‚å…³è”åˆ†æ (Cross-Index)

#### å…¸å‹åœºæ™¯
**ç”¨æˆ·è¾“å…¥**: "åˆ†æè®¢å•å¤±è´¥ä¸æ”¯ä»˜ç½‘å…³å¼‚å¸¸çš„å…³è”æ€§"

#### Agent æ¨ç†é“¾

```
ç¬¬ 1 æ­¥: å¤šç´¢å¼•è¯†åˆ«
  â””â”€ æ¨æ–­: è®¢å• â†’ orders-*, æ”¯ä»˜ â†’ payments-*
  â””â”€ è°ƒç”¨ list_indices éªŒè¯å­˜åœ¨æ€§

ç¬¬ 2 æ­¥: æ—¶é—´çª—å£å¯¹é½
  â””â”€ ä» orders-* ä¸­æå–å¤±è´¥è®¢å•çš„æ—¶é—´æˆ³åˆ†å¸ƒ
  â””â”€ ä» payments-* ä¸­æå–ç½‘å…³å¼‚å¸¸çš„æ—¶é—´æˆ³åˆ†å¸ƒ

ç¬¬ 3 æ­¥: å…³è”æŸ¥è¯¢ (ä½¿ç”¨ ES|QL çš„ JOIN æˆ–åˆ†æ­¥èšåˆ)
  â””â”€ æ–¹æ¡ˆ A: å¦‚æœ ES|QL æ”¯æŒ JOIN
      FROM orders-2025.01 AS o
      | JOIN payments-2025.01 AS p ON o.payment_id == p.id
      | WHERE o.status == "failed" AND p.gateway_status == "error"
  
  â””â”€ æ–¹æ¡ˆ B: åˆ†æ­¥èšåˆ + Agent ä¾§å…³è”
      â”œâ”€ æŸ¥è¯¢ 1: è®¢å•å¤±è´¥çš„æ—¶é—´åˆ†å¸ƒ (æŒ‰å°æ—¶)
      â”œâ”€ æŸ¥è¯¢ 2: æ”¯ä»˜å¼‚å¸¸çš„æ—¶é—´åˆ†å¸ƒ (æŒ‰å°æ—¶)
      â””â”€ Agent è®¡ç®—ç›¸å…³ç³»æ•°

ç¬¬ 4 æ­¥: å¯è§†åŒ–å»ºè®®
  â””â”€ è¾“å‡º:
      """
      ğŸ“‰ å…³è”åˆ†æç»“æœ:

      **æ—¶é—´é‡å ç‡**: 78% çš„è®¢å•å¤±è´¥å‘ç”Ÿåœ¨æ”¯ä»˜ç½‘å…³å¼‚å¸¸çš„å‰å 5 åˆ†é’Ÿå†…

      **é«˜å³°æ—¶æ®µ**:
      - 2025-01-20 14:00-15:00: è®¢å•å¤±è´¥ 45 ç¬”ï¼Œæ”¯ä»˜å¼‚å¸¸ 52 æ¬¡
      - 2025-01-21 09:30-10:00: è®¢å•å¤±è´¥ 38 ç¬”ï¼Œæ”¯ä»˜å¼‚å¸¸ 41 æ¬¡

      **ç»“è®º**: å¼ºç›¸å…³ï¼Œå»ºè®®ä¼˜å…ˆæ’æŸ¥æ”¯ä»˜ç½‘å…³æœåŠ¡
      """
```

#### å…³é”®èƒ½åŠ›
*   **å¤šç´¢å¼•ååŒ**: è·¨ä¸åŒä¸šåŠ¡ç´¢å¼•è¿›è¡Œå…³è”åˆ†æã€‚
*   **æ—¶åºå¯¹é½**: å¤„ç†ä¸åŒç²’åº¦çš„æ—¶é—´æˆ³æ•°æ®ã€‚
*   **ç»Ÿè®¡æ¨ç†**: è®¡ç®—ç›¸å…³æ€§ã€å¼‚å¸¸ç‡ç­‰æŒ‡æ ‡ã€‚

---

## ä¸‰ã€å®ç°è¿™äº›èƒ½åŠ›çš„å…³é”®æŠ€æœ¯è¦ç´ 

### 1. Prompt å·¥ç¨‹ (å·²å®Œæˆ âœ…)
*   **Critical Rule**: ç¡®ä¿é”™è¯¯æ—¶ä¸æ²‰é»˜ã€‚
*   **Workflow Examples**: æä¾›å¤šåœºæ™¯çš„æ¨ç†æ¨¡æ¿ã€‚
*   **æ¡ä»¶åˆ†æ”¯é€»è¾‘**: æ˜ç¡® if-then-else çš„å†³ç­–æ ‘ã€‚

### 2. å·¥å…·ç¼–æ’å¼•æ“ (Tool Orchestration)
å½“å‰çš„ MCP æ¶æ„å·²æ”¯æŒï¼Œä½†éœ€è¦ Agent å…·å¤‡ï¼š
*   **ä¾èµ–è¯†åˆ«**: çŸ¥é“å“ªäº›å·¥å…·çš„è¾“å‡ºå¯ä»¥ä½œä¸ºä¸‹ä¸€ä¸ªå·¥å…·çš„è¾“å…¥ã€‚
*   **å¹¶è¡Œè°ƒç”¨**: ä¾‹å¦‚åŒæ—¶æŸ¥è¯¢å¤šä¸ªç´¢å¼•çš„ Mappingã€‚
*   **ç»“æœç¼“å­˜**: é¿å…é‡å¤è°ƒç”¨ `list_indices`ã€‚

### 3. ä¸Šä¸‹æ–‡ç®¡ç† (Memory)
*   **çŸ­æœŸè®°å¿†**: è®°ä½å½“å‰ä¼šè¯ä¸­çš„ç´¢å¼•åã€å­—æ®µåã€è¿‡æ»¤æ¡ä»¶ã€‚
*   **é•¿æœŸè®°å¿†**: è®°ä½å¸¸ç”¨ç´¢å¼•çš„ Schemaã€ç”¨æˆ·çš„ä¹ æƒ¯æŸ¥è¯¢æ¨¡å¼ã€‚

### 4. é¢†åŸŸçŸ¥è¯†æ³¨å…¥
*   **ES æœ€ä½³å®è·µåº“**: 
    *   "ç£ç›˜ä½¿ç”¨è¶… 85% éœ€è¦å‘Šè­¦"
    *   "ä¸»åˆ†ç‰‡æ•° = èŠ‚ç‚¹æ•° Ã— (1-3) æ˜¯æ¨èé…ç½®"
*   **å¸¸è§æ•…éšœæ¨¡å¼**: 
    *   "Yellow + unassigned_shards > 0 â†’ å‰¯æœ¬ä¸è¶³"
    *   "Red + cluster_block_exception â†’ ç£ç›˜æ°´ä½çº¿è§¦å‘"

---

## å››ã€ä¸åœºæ™¯ 2 (ç‰¹å®šä¸šåŠ¡åœºæ™¯) çš„è¾¹ç•Œ

| ç»´åº¦ | åœºæ™¯ 1 (é€šç”¨) | åœºæ™¯ 2 (ç‰¹å®šä¸šåŠ¡ + RAG) |
|------|-------------|---------------------|
| **ç´¢å¼•è¯†åˆ«** | åŸºäºæ¨¡å¼åŒ¹é… (`*log*`, `*order*`) | ä»çŸ¥è¯†åº“è·å– (`fdz-*` å¯¹åº”é˜²ç”µè¯ˆç³»ç»Ÿ) |
| **å­—æ®µè¯­ä¹‰** | ä¾èµ– Mapping | ä» RAG è·å–ä¸šåŠ¡å«ä¹‰ ("yj" = "é¢„è­¦") |
| **æŸ¥è¯¢æ„é€ ** | é€šç”¨ ES|QL è¯­æ³• | ä¸šåŠ¡ç‰¹å®šçš„æŸ¥è¯¢æ¨¡æ¿ |
| **ç»“æœè§£è¯»** | æŠ€æœ¯å±‚é¢ (åˆ†ç‰‡ã€èŠ‚ç‚¹) | ä¸šåŠ¡å±‚é¢ (é¢„è­¦ç‡ã€è¯¯æŠ¥ç‡) |

**å…³é”®åŒºåˆ«**: åœºæ™¯ 1 æ˜¯"æˆ‘çŸ¥é“å·¥å…·æ€ä¹ˆç”¨"ï¼Œåœºæ™¯ 2 æ˜¯"æˆ‘çŸ¥é“ä½ çš„ä¸šåŠ¡æ˜¯ä»€ä¹ˆ"ã€‚

---

## äº”ã€è½åœ°å»ºè®®

### çŸ­æœŸ (1-2 å‘¨)
1.  âœ… å®Œå–„ `PROMPT/ElasticSearchBot.md` çš„æ¡ä»¶åˆ†æ”¯é€»è¾‘ã€‚
2.  æµ‹è¯• 3-5 ä¸ªå…¸å‹æ•…éšœåœºæ™¯ï¼Œä¼˜åŒ– Agent çš„æ¨ç†å‡†ç¡®ç‡ã€‚
3.  åœ¨ Dify ä¸­é…ç½®å·¥å…·è¶…æ—¶å’Œé”™è¯¯å¤„ç†ã€‚

### ä¸­æœŸ (1 ä¸ªæœˆ)
1.  å»ºç«‹"ES è¿ç»´çŸ¥è¯†åº“" (Markdown æ–‡æ¡£)ï¼Œé€šè¿‡ RAG æ³¨å…¥ã€‚
2.  å¼€å‘"å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†"æ¨¡å—ã€‚
3.  å¼•å…¥å¯è§‚æµ‹æ€§ï¼šè®°å½• Agent çš„å·¥å…·è°ƒç”¨é“¾è·¯å’Œå†³ç­–è¿‡ç¨‹ã€‚

### é•¿æœŸ (2-3 ä¸ªæœˆ)
1.  å®ç°"é¢„æµ‹æ€§ç»´æŠ¤"ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹åˆ†ç‰‡å€¾æ–œã€ç£ç›˜æ»¡ç­‰é—®é¢˜ã€‚
2.  å¼€å‘"è‡ªåŠ¨ä¿®å¤"èƒ½åŠ›ï¼šä¾‹å¦‚è‡ªåŠ¨è§¦å‘ç´¢å¼•æ¸…ç†ã€åˆ†ç‰‡å†å¹³è¡¡ã€‚
3.  ä¸ Ansible MCP æ‰“é€šï¼Œå®ç°"è¯Šæ–­ + æ‰§è¡Œ"é—­ç¯ã€‚

---

## å…­ã€ç¤ºä¾‹ Prompt ç‰‡æ®µ (é’ˆå¯¹èƒ½åŠ› 1)

```markdown
# Advanced Capability: Root Cause Analysis

When a user reports "cluster is slow" or "something is wrong", follow this workflow:

## Step 1: Health Triage
1. Call `get_cluster_health`
2. Interpret status:
   - Green â†’ Check nodes for performance issues
   - Yellow â†’ Investigate replica shards
   - Red â†’ Emergency: locate missing primary shards

## Step 2: Index-Level Diagnosis
- If unhealthy indices found, call `list_indices_detailed(health=<detected_status>)`
- Sort by size to prioritize large problematic indices

## Step 3: Shard-Level Forensics
- For each problematic index, call `get_shards(index=<name>)`
- Identify UNASSIGNED/INITIALIZING shards and their last known nodes

## Step 4: Node Health Check
- Call `get_nodes_info()`
- Cross-reference with shard allocation data
- Detect: offline nodes, high heap usage (>85%), disk full (>90%)

## Step 5: Root Cause Report
Synthesize findings into:
- **Root Cause**: [One sentence summary]
- **Impact**: [What data/queries are affected]
- **Immediate Actions**: [Commands to run]
- **Prevention**: [Configuration recommendations]
```

è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆå¹³è¡¡äº†"å½“å‰å·¥å…·èƒ½åŠ›"ä¸"æœªæ¥æ‰©å±•ç©ºé—´"ï¼Œä¸ºä½ çš„ AIOps ç³»ç»Ÿæä¾›äº†æ¸…æ™°çš„æ¼”è¿›è·¯å¾„ã€‚
